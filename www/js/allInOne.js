angular.module("stopwatch",[]).controller("baseCtrl",["$scope","$rootScope","$window",function(a,b,c){b.vars={differenceLapsMode:!0};a.$on("createNewLap",function(b,c){a.$broadcast("postNewLap",c)});a.$on("resetAllCtrls",function(b){console.log("baseCtrl - reset");a.$broadcast("reset")});b.baseInit=function(){};c.onbeforeunload=function(){a.$broadcast("onbeforeunload")}}]).controller("panelCtrl",["$scope","$rootScope","$interval",function(a,b,c){a.vars;a.$on("onbeforeunload",function(){saveJsonToLocalStorage("currentVars",
a.vars)});a.$on("reset",function(){console.log("panelCtrl - reset");a.init()});a.init=function(){null!=localStorage.getItem("currentVars")?(a.vars=angular.fromJson(localStorage.getItem("currentVars")),a.vars.startAt=new Date(a.vars.startAt),console.log("restore last vars"),console.dir(a.vars),1==a.vars.runningMode&&(console.log("user was in running mode"),a.playAndPause(!0))):a.vars={timeToShow:"00:00.00",time:0,startAt:0,interval:null,runningMode:-1,incrementMillis:0,staticData:{TIME_TO_RENDER:61,
TEMP_TITLE:"Double click to edit..",START:"Start",STOP:"Stop"}}};a.playAndPause=function(b){b?(a.start(),console.log("stop-watch restored...")):(1==a.vars.runningMode?(a.stop(),console.log("stop-watch stopped!")):(a.start(),console.log("stop-watch started...")),a.vars.runningMode*=-1)};a.start=function(){$("#playStop").val(a.vars.staticData.STOP);0==a.vars.time&&(a.vars.startAt=new Date);a.vars.interval=c(function(){a.vars.time=(new Date).getTime()-a.vars.startAt.getTime();a.vars.timeToShow=formatTime(a.vars.time);
a.vars.incrementMillis+=a.vars.staticData.TIME_TO_RENDER;500<=a.vars.incrementMillis&&($(".blink_me").animate({opacity:.5},250).animate({opacity:1},250),a.vars.incrementMillis=0)},a.vars.staticData.TIME_TO_RENDER)};a.stop=function(){a.vars.interval&&($("#playStop").val(a.vars.staticData.START),c.cancel(a.vars.interval))};a.newLap=function(){a.vars.interval&&a.$emit("createNewLap",{timeToShow:"",time:a.vars.time,title:a.vars.staticData.TEMP_TITLE,isEdit:!1})};a.reset=function(){a.stop();localStorage.removeItem("currentVars");
localStorage.removeItem("currentLaps");a.$emit("resetAllCtrls")}}]).controller("listCtrl",["$scope","$window","$rootScope",function(a,b,c){a.vars={laps:[]};a.$on("onbeforeunload",function(){saveJsonToLocalStorage("currentLaps",a.vars.laps)});a.$on("reset",function(){console.log("listCtrl - reset");a.init()});a.$on("postNewLap",function(b,d){d.timeToShow=c.vars.differenceLapsMode?0<a.vars.laps.length?formatTime(d.time-a.vars.laps[0].time):formatTime(d.time):formatTime(d.time);a.vars.laps.unshift(d)});
a.init=function(){a.vars={laps:[]};null!=localStorage.getItem("currentLaps")&&(console.log("restore last laps"),a.vars.laps=angular.fromJson(localStorage.getItem("currentLaps")),console.dir(a.vars.laps))};a.editLapTitle=function(b,c){var e=a.vars.laps.indexOf(b);a.vars.laps[e].isEdit=!0;e=$("#list .title-edit")[c];e.selectionStart=e.selectionEnd=$(e).val().length};a.removeLap=function(b){b=a.vars.laps.indexOf(b);a.vars.laps.splice(b,1)}}]).directive("myEnter",function(){return function(a,b,c){b.bind("keydown keypress",
function(b){13===b.which&&(a.$apply(function(){a.$eval(c.myEnter)}),b.preventDefault())})}});function saveJsonToLocalStorage(a,b){localStorage.setItem(a,angular.toJson(b))}function pad(a,b){var c="0000"+a;return c.substr(c.length-b)}function formatTime(a){var b=m=s=ms=0,b="",b=Math.floor(a/36E5);a%=36E5;m=Math.floor(a/6E4);a%=6E4;s=Math.floor(a/1E3);ms=a%1E3;return b=b?pad(b,2)+":"+pad(m,2)+":"+pad(s,2)+"."+pad(ms,2):pad(m,2)+":"+pad(s,2)+"."+pad(ms,2)};